parameters:
    environment: ''
    artifactName: ''
    serviceConnection: ''
    webAppName: ''

jobs:
- deployment : '${{ parameters.webAppName }}'
  pool: 
    vmImage: 'ubuntu-latest'
  environment: '${{ parameters.environment }}'
  strategy:
        runOnce:
         deploy:
           steps:
           - task: DownloadBuildArtifacts@0
             inputs:
               buildType: 'current'
               downloadType: 'single'
               artifactName: '${{ parameters.artifactName }}'
               downloadPath: '$(System.ArtifactsDirectory)'

           - script: |
                echo "Listing files in the artifacts directory:"
                if [ -d "$(System.ArtifactsDirectory)" ]; then
                  ls "$(System.ArtifactsDirectory)" # for Linux agents
                else
                  dir "$(System.ArtifactsDirectory)" # for Windows agents
                fi
              displayName: 'List Artifacts'


           - task: AzureRmWebAppDeployment@4
             inputs:
              ConnectionType: 'AzureRM'
              azureSubscription: '${{ parameters.serviceConnection }}'
              appType: 'webApp'
              WebAppName: '${{ parameters.webAppName }}'
              package: '$(Build.ArtifactStagingDirectory)/**/*.zip'